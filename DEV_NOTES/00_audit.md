<!--
MIT License

Copyright (c) 2025 Age-Of-Ages

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
# Workspace Audit

## Tech Stack Snapshot
- net8.0-windows WPF desktop app using CommunityToolkit.Mvvm and Microsoft.Extensions.DependencyInjection (`JumpchainCharacterBuilder.csproj`)
- MVVM pattern with ObservableObject/ObservableValidator partial classes generated by source generators
- Messaging via `WeakReferenceMessenger` to coordinate save/load/settings between viewmodels

## Core Domain Models
- `SaveFile`: aggregate root storing `JumpList`, `CharacterList`, supplement settings, and base category presets; serialized via DataContract in `XmlAccess`.
- `Jump` (`JumpDetailModel.cs`): extends `DocumentDetail`; tracks origin options, duration, numbering, gauntlet flag, `Currencies`, `PurchaseTypes`, and per-character `JumpBuild` entries. Handles origin discount automation thresholds.
- `JumpBuild` (`JumpBuildModel.cs`): per-character build state containing stipends, origin selections, demographics (age/gender), purchase lists, companion imports, drawbacks/scenarios, and point bank fields.
- `Purchase` (`PurchaseModel.cs`): generalized record for Perks/Items/etc. Fields cover cost, category, type index, body-mod toggles, temporariness, description, and nested `PurchaseAttribute` list plus provenance (source jump/character).
- `PurchaseAttribute` (`PurchaseAttributeModel.cs`): describes granted attributes/skills/boosters with type/category lists, numeric value, or ranked power via `AttributeCalculationClass.RankList` enum.
- `CompanionPurchase` (`CompanionPurchaseModel.cs`) + `CompanionImportDetailClass`: model companion recruitment options and per-companion stipend toggles.
- `Drawback` (`DrawbackModel.cs`): captures drawback/scenario selection with name, point value, description, and reward text.
- `Character` (`CharacterModel.cs`): represents Jumper/companions including identity data, biography fields, stat blocks, boosters, body mods, alt-forms.
- `Currency`, `PurchaseType`, `OriginDetail`, `Options`, `ExportOptions`, `ExportFormatToggle`: supporting models for budgeting, purchase typing, origin metadata, global options, and export section toggles.

## Persistence & Migration
- Saves stored under `Saves/` as XML via `XmlAccess.WriteObject`/`ReadObject`; backups rolled under `Backups/` before overwrites.
- `SaveFileLoader` handles loading/new-save flow and delegates to `SaveMigration` for version upgrades (<1.1, <1.3, <1.4).
- `TxtAccess` writes export artifacts into `Exports/<Category>/` subfolders, sanitizing filenames.
- `CfgAccess` reads/writes simple configuration (window settings, theme, etc.).

## Export Pipeline
- `ExportViewModel` (~5k lines) orchestrates exporting builds, passports, warehouses, body mods, and drawback supplements in Generic, BBCode, and Markdown formats.
  - Section ordering and inclusion driven by `ExportOptions` toggle lists.
  - Generates formatted `List<string>` buffers per section, applies budget formatting helpers from `FormatHelper` and writes via `TxtAccess`.
  - Supports companion builds (optional), spoiler formatting, and per-section styling.
- `FormatHelper` cleans copied text (esp. pasted from PDFs), normalizes whitespace, formats numeric budgets with configurable thousand separators.

## UI Flow Overview
- `MainWindowView` hosts a `TabControl` with top-level modules: Jumpchain Overview, Cosmic Passport, Cosmic Warehouse, Cosmic Locker, Drawback Supplement, Export, Statistics, Jumpchain Options; `TopMenuView` provides file/settings commands.
- `JumpchainOverviewView`: split layout with jump list (sortable/mutable) and detail tabs (`Origins`, `Jump Builds`, `Companion Imports`, `Drawbacks`, `Scenarios`, `Jump Settings`, `Supplements`). Each tab binds into `JumpchainOverviewViewModel` collections for editing purchases, origin metadata, stipends, and supplements.
- `CosmicPassportView`: character management (create/delete), tabbed profile editor covering biography, physical traits, personality, skills/attributes, boosters, alt-forms.
- `CosmicWarehouseView`: supplement-focused UI with statistics, categorized purchases, additions, limitations depending on selected warehouse mode (Generic vs Personal Reality toggles).
- `CosmicLockerView`, `DrawbackSupplementView`, `StatisticsView`, `JumpchainOptionsView`: specialized panels for body mods, drawback add-ons, analytics, and global options respectively.
- `Messages/` folder defines toolkit messenger payloads for save/load, settings, randomizer events, enabling loose coupling between viewmodels and services.

## PDF Handling Status
- No dedicated PDF ingestion or parsing pipeline exists. Only indirect touchpoint is `FormatHelper.RemoveLineBreaks`, which cleans text pasted from PDFs for manual entry. Future PDF preview/extraction must be built from scratch.

## Notable Services
- `RandomizeListAccess`, `ListOperationsClass`, `ListValidationClass`, `AttributeCalculationClass`, etc., provide business rules for point totals, list movement, validation, attribute math.
- `Services/` implements `DialogService`, settings persistence, clipboard helpers, and randomization utilities used across the MVVM layer.
